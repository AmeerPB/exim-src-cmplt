Backport of:

From 32da6327e434e986a18b75a84f2d8c687ba14619 Mon Sep 17 00:00:00 2001
From: Jeremy Harris <jgh146exb@wizmail.org>
Date: Thu, 1 Sep 2022 15:54:35 +0100
Subject: [PATCH] Fix non-WITH_CONTENT_SCAN build (3)

Broken-by: d8ecc7bf97
---
 src/src/expand.c | 4 ++++
 1 file changed, 4 insertions(+)

--- a/src/expand.c
+++ b/src/expand.c
@@ -1895,6 +1895,7 @@ if (Ustrncmp(name, "auth", 4) == 0)
   if (*endptr == 0 && n != 0 && n <= AUTH_VARS)
     return !auth_vars[n-1] ? US"" : auth_vars[n-1];
   }
+#ifdef WITH_CONTENT_SCAN
 else if (Ustrncmp(name, "regex", 5) == 0)
   {
   uschar *endptr;
@@ -1902,6 +1903,7 @@ else if (Ustrncmp(name, "regex", 5) == 0
   if (*endptr == 0 && n != 0 && n <= REGEX_VARS)
     return !regex_vars[n-1] ? US"" : regex_vars[n-1];
   }
+#endif
 
 /* For all other variables, search the table */
 
@@ -8564,9 +8566,11 @@ tree_walk(acl_var_m, assert_variable_not
 for (int i = 0; i < AUTH_VARS; i++) if (auth_vars[i])
   assert_variable_notin(US"auth<n>", auth_vars[i], &e);
 
+#ifdef WITH_CONTENT_SCAN
 /* check regex<n> variables */
 for (int i = 0; i < REGEX_VARS; i++) if (regex_vars[i])
   assert_variable_notin(US"regex<n>", regex_vars[i], &e);
+#endif
 
 /* check known-name variables */
 for (var_entry * v = var_table; v < var_table + var_table_size; v++)
